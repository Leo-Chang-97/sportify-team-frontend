# 圖片裁切功能整合說明

## 概述

已成功在 `hero-banner-member.jsx` 中整合了圖片裁切編輯上傳功能，用戶現在可以在上傳頭像時進行裁切編輯。

## 新增的文件

### 1. `utils/cropImage.js`

- 圖片裁切工具函數
- 使用 Canvas API 進行圖片裁切
- 支援高品質圖片輸出

### 2. `components/ui/image-crop-dialog.jsx`

- 裁切對話框組件
- 使用 `react-easy-crop` 庫進行裁切操作
- 支援縮放控制和圓形裁切

## 修改的文件

### `components/hero-banner-member.jsx`

主要修改內容：

1. 導入 `ImageCropDialog` 組件
2. 新增狀態管理：
   - `showCropDialog`: 控制裁切對話框顯示
   - `selectedImageSrc`: 存儲選中的圖片源
3. 新增函數：
   - `readFile()`: 讀取檔案為 base64
   - `handleFileSelect()`: 處理檔案選擇
   - `handleCropComplete()`: 處理裁切完成
4. 修改檔案上傳流程：
   - 選擇檔案 → 顯示裁切對話框 → 裁切完成 → 上傳

## 功能特點

1. **圓形裁切**: 頭像使用圓形裁切，符合頭像顯示需求
2. **寬範圍縮放控制**: 支援 50% - 500% 的縮放範圍，讓用戶有更大的調整空間
3. **精確裁切**: 修正後的裁切邏輯確保裁切結果與選擇範圍完全一致
4. **標準檔案格式**: 回傳標準的 File 物件，不是 base64 字串
5. **最佳化輸出**: 使用 JPEG 格式，檔案較小且相容性好
6. **即時預覽**: 裁切過程中可以即時看到效果
7. **高品質輸出**: 使用高品質設定進行圖片裁切
8. **錯誤處理**: 完整的錯誤處理和用戶提示
9. **用戶友好**: 提供操作提示和視覺反饋

## 使用流程

1. 用戶點擊頭像
2. 選擇圖片檔案
3. 系統驗證檔案類型和大小
4. 顯示裁切對話框
5. 用戶調整裁切區域和縮放
6. 點擊確認裁切
7. 系統上傳裁切後的圖片
8. 更新頭像顯示

## 依賴要求

- `react-easy-crop`: 圖片裁切庫
- `@radix-ui/react-slider`: 滑桿控制組件

## 測試

可以使用 `test-crop.jsx` 文件進行功能測試。

## 修正內容

### 縮放範圍問題

- **修正前**: 縮放範圍限制在 100% - 300%
- **修正後**: 縮放範圍擴展到 50% - 500%，提供更大的調整空間
- **新增功能**: 在 Cropper 組件中設定 `minZoom={0.5}` 和 `maxZoom={5}`

### 裁切精度問題

- **修正前**: 裁切邏輯複雜，可能導致裁切結果與選擇範圍不符
- **修正後**: 簡化裁切邏輯，直接使用 `drawImage` 方法進行精確裁切
- **改進**: 移除不必要的像素比例計算，確保裁切結果準確

### 縮放精度改進

- **修正前**: 縮放控制精度較低
- **修正後**: 支援 1% 精度的縮放調整 (step=0.01)
- **改進**: 修改 Slider 組件支援 step 屬性，提供更精確的控制

### 重複檔案名稱支援

- **修正前**: 選擇相同檔案名稱時瀏覽器會忽略選擇
- **修正後**: 自動清空檔案輸入值，允許重新選擇相同檔案
- **改進**: 在各種情況下（錯誤、取消、完成）都會清空檔案輸入

### 檔案格式改進

- **修正前**: 回傳 Blob 物件，檔案資訊不完整
- **修正後**: 回傳標準的 File 物件，包含完整的檔案資訊
- **簡化設計**: 使用 JPEG 作為預設格式，檔案較小且相容性好
- **改進**: 檔案名稱包含格式副檔名，便於識別

### 用戶體驗改進

- 新增操作提示文字
- 改進縮放控制的視覺顯示
- 對話框開啟時自動重置狀態
- 新增 `onDialogClose` 回調函數處理檔案輸入清空

## 注意事項

1. 確保後端 API 支援 Blob 格式的檔案上傳
2. 圖片大小限制為 5MB
3. 支援的圖片格式：所有瀏覽器支援的圖片格式
4. 裁切後的圖片品質設定為 0.8（可調整）
5. 縮放範圍：50% - 500%，提供更大的調整彈性
6. 縮放精度：支援 1% 精度的調整 (step=0.01)
7. 重複檔案支援：可以重新選擇相同檔案名稱的圖片
8. 檔案格式：回傳標準的 File 物件，可直接上傳到後端
9. 輸出格式：使用 JPEG 格式，檔案較小且相容性好
